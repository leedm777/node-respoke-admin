<!DOCTYPE html><html><head><title>lib/client.js - respoke</title><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script></head><body><div class="container"><h1>respoke</h1><h2 class="help-block">lib/client.js</h2><div id="respoke" class="comment"><div><p>A general purpose client for communicating with Respoke over REST and web sockets.</p>
<pre><code> npm install respoke
</code></pre><h2 id="usage">Usage</h2>
<pre><code> var Respoke = require(&#39;respoke&#39;);
 // . . .
 var respoke = new Respoke(opts);
</code></pre></div><br><br><h2>Properties and Methods</h2></div><div id="tokens" class="comment"><h3><code>object</code><a href="#tokens" class="bold"> respoke.tokens</a></h3><div><p>Header tokens used when performing REST or web socket requests to Respoke.</p>
</div><br><br></div><div id="tokens['Admin-Token']" class="comment"><h3><code>string</code><a href="#tokens['Admin-Token']" class="bold"> respoke.tokens['Admin-Token']</a></h3><div><p>Header <code>Admin-Token</code></p>
</div><br><br></div><div id="tokens['App-Secret']" class="comment"><h3><code>string</code><a href="#tokens['App-Secret']" class="bold"> respoke.tokens['App-Secret']</a></h3><div><p>Header <code>App-Secret</code></p>
</div><br><br></div><div id="tokens['App-Token']" class="comment"><h3><code>string</code><a href="#tokens['App-Token']" class="bold"> respoke.tokens['App-Token']</a></h3><div><p>Header <code>App-Token</code></p>
</div><br><br></div><div id="connectionId" class="comment"><h3><code>string</code><a href="#connectionId" class="bold"> respoke.connectionId</a></h3><div><p>If connected, this is the web socket connection ID with Respoke.</p>
</div><br><br></div><div id="baseURL" class="comment"><h3><code>string</code><a href="#baseURL" class="bold"> respoke.baseURL</a></h3><div><p>The base respoke api to use.</p>
<p>It should include the version with no trailing <code>/</code>.</p>
</div><br><br></div><div id="auth" class="comment"><h3><code>object</code><a href="#auth" class="bold"> respoke.auth</a></h3><div><p>Methods for obtaining auth credentials and connecting with Respoke.</p>
</div><br><br></div><div id="auth-admin" class="comment"><h3><a href="#auth.admin"><span class="bold"> respoke.auth.admin(opts, callback)</span></a></h3><div><p>Authenticate with full admin privileges.</p>
<p>Sets <code>respoke.tokens[&#39;Admin-Token&#39;]</code></p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>opts</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">Required</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.username</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.password</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="auth-appAuthSession" class="comment"><h3><a href="#auth.appAuthSession"><span class="bold"> respoke.auth.appAuthSession(opts, callback)</span></a></h3><div><p>As an endpoint, obtain an app auth session.</p>
<p>Sets <code>respoke.tokens[&#39;App-Token&#39;]</code>.</p>
<p>This token will allow connecting as a user over web socket without admin privileges.</p>
<p>In most cases, you will immediately call <code>.connect()</code>.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>opts</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.appAuthTokenId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="auth-endpoint" class="comment"><h3><a href="#auth.endpoint"><span class="bold"> respoke.auth.endpoint(opts, callback)</span></a></h3><div><p>As an admin (with <code>respoke.tokens[&#39;App-Token&#39;]</code> or <code>respoke.tokens[&#39;App-Secret&#39;]</code>),
obtain an <code>appAuthSessionId</code> which can be used to authenticate to Respoke as 
an endpoint.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>opts</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.appId</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">required</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.endpointId</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">required</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.roleId</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">required unless app is in development mode</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.ttl=86400</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">optional seconds time-to-live</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.auth['App-Secret']</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">optional override</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.auth['Admin-Token']</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">optional override</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5">(err, clientAuthData)</div></div><br class="visible-xs"><br><br></div><div id="auth-connect" class="comment"><h3><a href="#auth.connect"><span class="bold"> respoke.auth.connect(opts)</span></a></h3><div><p>Connect as a web socket client using the highest authentication token
currently available.</p>
<p>After calling this, listen for <code>respoke.on(&#39;connect&#39;)</code>.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>opts</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts['Admin-Token']</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts['App-Secret']</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts['App-Token']</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.connectParams</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5">optional Socket.io connection parameters</div></div><br class="visible-xs"><br><br></div><div id="auth-developmentMode" class="comment"><h3><a href="#auth.developmentMode"><span class="bold"> respoke.auth.developmentMode(opts, callback)</span></a></h3><div><p>Get an app auth token as an endpoint in <strong>development mode</strong>.</p>
<p>The response <code>{ tokenId: &#39;XXXX-XXXX-XXXX-XXXX&#39; } can then be used with</code>.authenticate.endpoint()`.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>opts</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.endpointId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.appId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>opts.ttl=60*60*6</code></div><div class="col-sm-3"><strong>number</strong></div><div class="col-sm-5">Seconds for the tokenId to live.</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5">(err, body)</div></div><br class="visible-xs"><br><br></div><div id="presence" class="comment"><h3><code>object</code><a href="#presence" class="bold"> respoke.presence</a></h3><div><p>Methods for interacting with presence indication.</p>
</div><br><br></div><div id="presence-observe" class="comment"><h3><a href="#presence.observe"><span class="bold"> respoke.presence.observe(endpoints, callback)</span></a></h3><div><p>Register as an observer of presence for the specified endpoint ids.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>endpoints</code></div><div class="col-sm-3"><strong>array&lt;string&gt;</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="presence-set" class="comment"><h3><a href="#presence.set"><span class="bold"> respoke.presence.set(params, callback)</span></a></h3><div><p>Set the presence for this endpoint, if connected.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>params</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.presence</code></div><div class="col-sm-3"><strong>string, number, object, array</strong></div><div class="col-sm-5">Your presence object</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.status</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5">Human readable status message</div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="sendMessage" class="comment"><h3><a href="#sendMessage"><span class="bold"> respoke.sendMessage(params)</span></a></h3><div><p>Send a message to an endpoint or specific connection of an endpoint.</p>
<p>Only one of these is required.</p>
<ul>
<li><code>params.endpointId</code></li>
<li><code>params.connectionId</code></li>
</ul>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>params</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.endpointId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.connectionId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.message</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5">required</div></div><br class="visible-xs"><br><br></div><div id="group-sendMessage" class="comment"><h3><a href="#group.sendMessage"><span class="bold"> respoke.group.sendMessage(params)</span></a></h3><div><p>Send a message to a group.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>params</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.groupId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.message</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="group-getMembers" class="comment"><h3><a href="#group.getMembers"><span class="bold"> respoke.group.getMembers(params, callback)</span></a></h3><div><p>Get the members of a group.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>params</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.groupId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="group-join" class="comment"><h3><a href="#group.join"><span class="bold"> respoke.group.join(params, callback)</span></a></h3><div><p>Join a group.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>params</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.groupId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="group-leave" class="comment"><h3><a href="#group.leave"><span class="bold"> respoke.group.leave(params, callback)</span></a></h3><div><p>Leave a group.</p>
</div><br><h4>Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>params</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>params.groupId</code></div><div class="col-sm-3"><strong>string</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><div class="row param"><div class="col-sm-4"><code>callback</code></div><div class="col-sm-3"><strong>function</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><br><br><h2>Events</h2><p>Listen for events on an instance of this class.</p><pre><code>respoke.on('event-name', function (arg) {
 
});</code></pre><br><div id="event-connect"><h3><code>event</code> <a href="#event-connect" class="bold">connect</a></h3><div><p>Connected to respoke.</p>
</div><br><br></div><div id="event-disconnect"><h3><code>event</code> <a href="#event-disconnect" class="bold">disconnect</a></h3><div><p>Disconnected from respoke.</p>
</div><br><br></div><div id="event-reconnect"><h3><code>event</code> <a href="#event-reconnect" class="bold">reconnect</a></h3><div><p>Reconnected with respoke.</p>
</div><br><br></div><div id="event-reconnecting"><h3><code>event</code> <a href="#event-reconnecting" class="bold">reconnecting</a></h3><div><p>Reconnecting with respoke.</p>
</div><br><br></div><div id="event-error"><h3><code>event</code> <a href="#event-error" class="bold">error</a></h3><div><p>An error occurred.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>err</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-message"><h3><code>event</code> <a href="#event-message" class="bold">message</a></h3><div><p>There is an incoming private message, from an endpoint.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>msg</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-presence"><h3><code>event</code> <a href="#event-presence" class="bold">presence</a></h3><div><p>Presence for an endpoint has changed or is now available.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>res</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-join"><h3><code>event</code> <a href="#event-join" class="bold">join</a></h3><div><p>An endpoint (which can include this client) has joined a group.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>res</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-leave"><h3><code>event</code> <a href="#event-leave" class="bold">leave</a></h3><div><p>An endpoint (which can include this client) has left a group.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>res</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div><div id="event-pubsub"><h3><code>event</code> <a href="#event-pubsub" class="bold">pubsub</a></h3><div><p>A group message has been received.</p>
</div><br><h4>Callback Arguments</h4><div class="row hidden-xs param"><div class="col-sm-4">Name</div><div class="col-sm-3">Type</div><div class="col-sm-5"></div></div><div class="row param"><div class="col-sm-4"><code>res</code></div><div class="col-sm-3"><strong>object</strong></div><div class="col-sm-5"></div></div><br class="visible-xs"><br><br></div></div></body></html>